project:
  type: manuscript
  resources:
    - /resources
    - /resources/*.pdf

manuscript:
  article: index.qmd

bibliography: references.bib
csl: the-lancet.csl

format:
  html:

    theme: [default, _extensions/frpQuarto/styles.scss]

    html-table-processing: none
    tbl-cap-location: bottom

    other-links:
      - text: NASA Open Data
        href: https://data.nasa.gov/
    code-links:
      - text: Data Import Code
        icon: file-code
        href: data-import.py

    toc: true
    toc-depth: 3

    template-partials:
        - _extensions/frpQuarto/title-block.html

    filters:
        - at: pre-quarto
          path: _extensions/frpQuarto/citeproc.lua
        - at: pre-quarto
          path: _extensions/frpQuarto/wordcount.lua

    include-after-body:
      text: |
        <script>
          document.addEventListener("DOMContentLoaded", () => {

            /* --------------------------------------------------
            * 1. FIGCAPTION TRANSFORMATION
            * -------------------------------------------------- */
            document.querySelectorAll("figcaption").forEach(e => {
              e.innerHTML = e.innerHTML.replace(
                /((.*?)\.)\s*(.*)/,
                '<div class="figcaption-title-lancet">$1</div>' +
                '<details class="dropdown-card">' +
                  '<summary>' +
                    '<span class="figcaption-dropdown">Show full caption</span>' +
                    '<span class="arrow">' +
                      '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">' +
                        '<polyline points="6 9 12 15 18 9"/>' +
                      '</svg>' +
                    '</span>' +
                  '</summary>' +
                  '<div class="figcaption-subtext">$3</div>' +
                '</details>'
              );
            });

            /* --------------------------------------------------
            * 2. WORDCOUNT â†’ TOC SIDEBAR
            * -------------------------------------------------- */
            const source = document.querySelector(".wordcount-source");
            const toc = document.querySelector("nav#TOC, nav[id$='TOC']");

            if (source && toc) {
              const container = document.createElement("div");
              container.classList.add(
                "add-info",
                "content-visible",
                "no-count"
              );

              container.innerHTML = source.innerHTML;

              const tocContent = toc.querySelector(".toc-content") || toc;
              tocContent.after(container);
            }

          });
        </script>